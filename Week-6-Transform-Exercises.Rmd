---
title: "Transform Data"
authr: Juan Ramirez
output: github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment="")
library(tidyverse)
# install.packages("babynames")
library(babynames)
```


# dplyr

```{r}
babynames %>% summarise(total = sum(n), max = max(n), min = min(n))
```


## Your Turn 1

Copmplete the code below to extract the rows where `name == "Khaleesi"`. Then use `summarise()` and `sum()` and `min()` to find:

1. The total number of children named Khaleesi
2. The first year Khaleesi appeared in the data

*(Hint: Be sure to remove each `_` before running the code)*

```{r}
babynames %>%  
  filter(name == "Khaleesi") %>% 
  summarise(total = sum(n), first = min(year))
```

```{r}
babynames %>% 
  filter(name == "Khaleesi") %>% 
  group_by(sex) %>% 
  summarise(total = sum(n))
```


## Your Turn 2

Use `group_by()`, `summarise()`, and `arrange()` to display the ten most popular names. Compute popularity as the *total* number of children of a single gender given a name.

*(Hint: Be sure to remove each `_` before running the code)*

```{r}
babynames %>%
  group_by(name, sex) %>% 
  summarise(total = sum(n)) %>% 
  arrange(desc(total)) %>% 
  head(10) %>% 
  ggplot() +
  geom_col(aes(x = fct_reorder(name, desc(total)), y = total, fill = sex)) + 
  labs(x = "10 Most Polular names since 1880", y = "Total number born") + 
  guides(fill = FALSE) + 
  theme_classic() + 
  scale_fill_manual(values = c("lightblue", "blue"))
```



```{r}
babynames %>% 
  mutate(percent = round(100*prop,2))
```


## Your Turn 3

Fill in the blanks to: 
Rank each name _within its year and sex_. 

*(Hint: Be sure to remove each `_` before running the code)*

```{r}
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(prop))) %>% 
  group_by(name) %>% 
  summarise(avg_rank = mean(rank)) %>% 
  arrange(avg_rank)
```


***

# Take aways

* Make tables of summaries with `summarise()`  
* Make new variables, with `mutate()`  
* Do groupwise operations with `group_by()`

* Connect operations with `%>%`  

